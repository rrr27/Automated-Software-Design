<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"> <html><head><meta content="text/html;charset=ISO-8859-1" http-equiv="Content-Type"><title>An MDELite Allegory Model</title></head> <body> <h1 style="text-align: center;"><span style="font-family: Helvetica,Arial,sans-serif;">An MDELite Allegory Model</span></h1> <span style="font-family: Helvetica,Arial,sans-serif;"><br><span style="font-family: Helvetica,Arial,sans-serif;">We recently made a connection between UML class diagrams and allegories -- categories that have power set domains. &nbsp;Here's the idea: a natural way to think about tuples in categories is by a domain of tuples. &nbsp;But what we really want in a relational database interpretation is a power set of tuples -- elements of this domain are sets of tuples -- i.e., relational tables. &nbsp;Arrows in this universe map tables-to-tables; this is exactly what relational algebra does.<br><br>Below is a UML class diagram that relates persons to the departments that they work in, departments to the divisions in which they reside, and persons with children (who are also persons):<br><br></span></span><div style="text-align: center;"><span style="font-family: Helvetica,Arial,sans-serif;"><span style="font-family: Helvetica,Arial,sans-serif;"><img style="width: 732px; height: 411px;" alt="" src="figures/PerEmpDiv.png"><br><br></span></span><div style="text-align: left;"><span style="font-family: Helvetica,Arial,sans-serif;">An allegory (category) with power domains is shown below. Arrow traversals are rightSemiJoins. A database that encodes these relationships is shown below:<br><span style="font-family: Helvetica,Arial,sans-serif;"></span></span><br><span style="font-family: Helvetica,Arial,sans-serif;"><span style="font-family: Helvetica,Arial,sans-serif;"></span></span></div><span style="font-family: Helvetica,Arial,sans-serif;"><span style="font-family: Helvetica,Arial,sans-serif;"></span></span></div><span style="font-family: Helvetica,Arial,sans-serif;"><span style="font-family: Helvetica,Arial,sans-serif;"></span></span><span style="font-family: Helvetica,Arial,sans-serif;"><span style="font-family: Helvetica,Arial,sans-serif;"></span></span><table style="text-align: left; margin-left: auto; margin-right: auto; width: 100px;" border="1" cellpadding="2" cellspacing="2"><tbody><tr><td style="text-align: left; font-weight: bold; vertical-align: top;"><pre><big>dbase(PDD,[Person,Department,Division,employs_worksin,childrenOf_parentsOf]).<br><br>table(Person,[pid,name,age]).<br>Person(p1,don,64).<br>Person(p2,karen,57).<br>Person(p3,hanna,23).<br>Person(p4,alex,25).<br>Person(p5,steve,53).<br>Person(p6,priscila,28).<br><br>table(Department,[did,name,inDiv:Division]).<br>Department(d1,mens,v1).<br>Department(d2,womens,v1).<br>Department(d3,appliances,v2).<br>Department(d4,hardware,v2).<br><br>table(Division,[vid,name]).<br>Division(v1,clothing).<br>Division(v2,goods).<br></big></pre></td><td style="text-align: left; font-weight: bold; vertical-align: top;"><pre><big>table(childrenOf_parentsOf,[id,childrenOf:Person,parentsOf:Person]).<br>childrenOf_parentsOf(c1,p3,p1).<br>childrenOf_parentsOf(c2,p3,p2).<br>childrenOf_parentsOf(c3,p4,p1).<br>childrenOf_parentsOf(c4,p4,p2).<br><br>table(employs_worksin,[id,Person:Person,Department:Department]).<br>employs_worksin(w1,p1,d1).<br>employs_worksin(w2,p2,d2).<br>employs_worksin(w3,p3,d2).<br>employs_worksin(w4,p4,d4).<br>employs_worksin(w5,p5,d3).<br>employs_worksin(w6,p6,d2).<br>employs_worksin(w7,p1,d3).<br></big></pre></td></tr></tbody></table><br><span style="font-family: Helvetica,Arial,sans-serif;"><span style="font-family: Helvetica,Arial,sans-serif;">Given this, here are some queries (easily transformed into constraints) that one can express. &nbsp;Note how compact they are.<br><br></span></span><ul style="font-family: Helvetica,Arial,sans-serif;"><li>print all persons whose name begins with 'd' or 'p'<span style="font-family: Helvetica,Arial,sans-serif;"></span><span style="font-family: Helvetica,Arial,sans-serif;"><span style="font-family: Helvetica,Arial,sans-serif;"><br></span></span><span style="font-family: Helvetica,Arial,sans-serif;"><span style="font-family: Helvetica,Arial,sans-serif;"></span></span><pre style="margin-left: 40px; font-weight: bold;"><big>        person.select(t-> t.get("name").startsWith("d") || t.get("name").startsWith("p")).print();<br></big></pre></li></ul><ul style="font-family: Helvetica,Arial,sans-serif;"><li>print all divisions in which don works<span style="font-family: Helvetica,Arial,sans-serif;"></span><span style="font-family: Helvetica,Arial,sans-serif;"><span style="font-family: Helvetica,Arial,sans-serif;"><br></span></span><span style="font-family: Helvetica,Arial,sans-serif;"><span style="font-family: Helvetica,Arial,sans-serif;"></span></span><pre style="margin-left: 40px; font-weight: bold;"><big>        person.select(t->t.is("name","don")).worksin().inDiv().print();<br></big></pre></li></ul><ul style="font-family: Helvetica,Arial,sans-serif;"><li>print all persons that work in the same department as priscila<span style="font-family: Helvetica,Arial,sans-serif;"></span><span style="font-family: Helvetica,Arial,sans-serif;"><span style="font-family: Helvetica,Arial,sans-serif;"><br></span></span><span style="font-family: Helvetica,Arial,sans-serif;"><span style="font-family: Helvetica,Arial,sans-serif;"></span></span><pre style="margin-left: 40px; font-weight: bold;"><big>        person.select(t->t.is("name","priscila")).worksin().employs().print();<br></big></pre></li></ul><ul style="font-family: Helvetica,Arial,sans-serif;"><li>who are the division colleagues of priscila<span style="font-family: Helvetica,Arial,sans-serif;"></span><span style="font-family: Helvetica,Arial,sans-serif;"><span style="font-family: Helvetica,Arial,sans-serif;"><br></span></span><span style="font-family: Helvetica,Arial,sans-serif;"><span style="font-family: Helvetica,Arial,sans-serif;"></span></span><pre style="margin-left: 40px; font-weight: bold;"><big>        person.select(t->t.is("name","priscila")).worksin().inDiv().hasDeps().employs().print();<br></big></pre></li></ul><ul style="font-family: Helvetica,Arial,sans-serif;"><li>print the children of persons<span style="font-family: Helvetica,Arial,sans-serif;"></span><span style="font-family: Helvetica,Arial,sans-serif;"><span style="font-family: Helvetica,Arial,sans-serif;"><br></span></span><span style="font-family: Helvetica,Arial,sans-serif;"><span style="font-family: Helvetica,Arial,sans-serif;"></span></span><pre style="margin-left: 40px; font-weight: bold;"><big>        person.childrenOf().print();<br></big></pre></li></ul><ul style="font-family: Helvetica,Arial,sans-serif;"><li>are there children who work in the same department as their parent?<span style="font-family: Helvetica,Arial,sans-serif;"></span><span style="font-family: Helvetica,Arial,sans-serif;"><span style="font-family: Helvetica,Arial,sans-serif;"><br></span></span><span style="font-family: Helvetica,Arial,sans-serif;"><span style="font-family: Helvetica,Arial,sans-serif;"></span></span><pre style="margin-left: 40px; font-weight: bold;"><big>        System.out.println("7) are there children who work in the same department as their parent?\n");<br>        person.forEach(p->{   <br>            PDD.Department pdepts = db.new Person(p).worksin();<br>            PDD.Department cdepts = db.new Person(p).childrenOf().worksin();<br>            PDD.Department inter = pdepts.intersect(cdepts);<br>            if (inter.size()!=0) {<br>                out.format("%s and at least one of his/her children work in the following departments\n", p.get("name"));<br>                inter.print();<br>                out.println();<br>            }<br>        });<br></big></pre></li></ul><span style="font-family: Helvetica,Arial,sans-serif;"><span style="font-family: Helvetica,Arial,sans-serif;"></span><span style="font-weight: bold;"></span></span><hr style="width: 100%; height: 2px;"><span style="font-family: Helvetica,Arial,sans-serif;"><span style="font-weight: bold;"></span>The above program, and the hand-written Java class that implements these arrows is in <span style="font-weight: bold;">MELite7/LectureExamples/allegory.</span> The current version of the allegory program is shown below. <br><br></span><div style="margin-left: 40px; font-weight: bold; color: rgb(153, 51, 0);"><span style="font-family: Helvetica,Arial,sans-serif;">Please note that this source, which is in the LectureExamples directory of MDELite7, is a single file with nested classes. &nbsp;Study it in detail -- the main ideas are shown below.</span><br><span style="font-family: Helvetica,Arial,sans-serif;"></span></div><span style="font-family: Helvetica,Arial,sans-serif;"><br></span><table style="text-align: left; margin-left: auto; margin-right: auto; width: 100px;" border="1" cellpadding="2" cellspacing="2"><tbody><tr><td style="vertical-align: top; font-weight: bold;"><pre><big>import PrologDB.DB;<br>import PrologDB.Table;<br>import PrologDB.TableSchema;<br>import PrologDB.Tuple;<br>import java.util.function.Consumer;<br>import java.util.function.Predicate;<br><br>public class PDD {<br><br>    DB db;<br>    public Table person;<br>    public Table department;<br>    public Table division;<br>    public Table employs_worksin;<br>    public Table childrenof_parentsof;<br><br>    public PDD(String fileName) {<br>        db = DB.readDataBase(fileName);<br>        person = db.getTableEH("Person");<br>        department = db.getTableEH("Department");<br>        division = db.getTableEH("Division");<br>        employs_worksin = db.getTableEH("employs_worksin");<br>        childrenof_parentsof = db.getTableEH("childrenOf_parentsOf");<br>    }<br></big></pre></td><td style="vertical-align: top; font-family: monospace; font-weight: bold;"><pre><big>class Department extends common&lt;Department&gt; {<br>       protected Department New(Table t) { return new Department(t); }<br><br>       public Department() { table = department; }<br><br>       public Department(Table t) { super("Department",t); }<br><br>       public Department(Tuple t) {  super("Department",t); }<br><br>       protected Department(String n, Table t) { super(n,t); }<br><br>       protected Department(String n, Tuple t) {  super(n,t); }<br><br>       public Person employs() {<br>          Table result1 = table.rightSemiJoin("did",employs_worksin,"Department");<br>          Table result2 = result1.rightSemiJoin("Person",person,"pid");<br>          return new Person(result2);<br>       }<br><br>       public Division inDiv() {<br>          Table result = table.rightSemiJoin("inDiv",division,"vid");<br>          return new Division(result);<br>       }<br>   }<br></big></pre></td></tr><tr><td style="vertical-align: top; font-weight: bold; font-family: monospace;"><pre><big>class Person extends common&lt;Person&gt; {<br>       protected Person New(Table t) { return new Person(t); }<br><br>       public Person() { table = person; }<br><br>       public Person(Table t) { super("Person",t); }<br><br>       public Person(Tuple t) {  super("Person",t); }<br><br>       protected Person(String n, Table t) { super(n,t); }<br><br>       protected Person(String n, Tuple t) {  super(n,t); }<br><br>       public Department worksin() {<br>          Table result1 = table.rightSemiJoin("pid",employs_worksin,"Person");<br>          Table result2 = result1.rightSemiJoin("Department",department,"did");<br>          return new Department(result2);<br>       }<br><br>       public Person childrenOf() {<br>          Table result1 = table.rightSemiJoin("pid",childrenof_parentsof,"parentsOf");<br>          Table result2 = result1.rightSemiJoin("childrenOf",person,"pid");<br>          return new Person(result2);<br>       }<br><br>       public Person parentsOf() {<br>          Table result1 = table.rightSemiJoin("pid",childrenof_parentsof,"childrenOf");<br>          Table result2 = result1.rightSemiJoin("parentsOf",person,"pid");<br>          return new Person(result2);<br>       }<br>   }<br></big></pre></td><td style="vertical-align: top; font-weight: bold;"><pre><big></big><big style="font-family: monospace;"><span style="font-weight: bold;">abstract class common&lt;T extends common&gt; {<br>       Table table;<br><br>       protected common() { }<br><br>       protected common(String tableName, Tuple t) {<br>          TableSchema ts = t.getSchema();<br>          if (!ts.getName().equals(tableName)) <br>            throw new RuntimeException("assigning non-"+tableName+" table to "+tableName);<br>          table = new Table(ts).add(t);<br>       }<br><br>       protected common(String tableName, Table tab) {<br>          if (!tab.getSchema().getName().equals(tableName)) {<br>             throw new RuntimeException("assigning non-"+tableName+" table to "+tableName);<br>          }<br>          table = tab;<br>        }<br><br>       public T select(Predicate<Tuple> p) {<br>          Table result = table.filter(p);<br>          return New(result);<br>        }<br><br>       protected abstract T New(Table t);<br><br>       public T id() { return New(table); }<br><br>       public void print() { table.print(System.out); }<br><br>       public void forEach(Consumer<Tuple> action) { table.stream().forEach(t -> action.accept(t)); }<br><br>       public T intersect(T tab) { return New(this.table.intersect(tab.table)); }<br><br>       public int size() { return this.table.count(); }<br><br>       public boolean equals(T tab) { return this.table.equals(tab.table); }<br>   }<br></span></big></pre></td></tr><tr><td style="vertical-align: top; font-weight: bold;" colspan="1" rowspan="1"><pre><big><span style="font-family: monospace;">class Division extends common&lt;Division&gt; {<br>       protected Division New(Table t) { return new Division(t); }<br><br>       public Division() { table = division; }<br><br>       public Division(Table t) { super("Division",t); }<br><br>       public Division(Tuple t) {  super("Division",t); }<br><br>       protected Division(String n, Table t) { super(n,t); }<br><br>       protected Division(String n, Tuple t) {  super(n,t); }<br><br>       public Department hasDeps() {<br>          Table result = table.rightSemiJoin("vid",department,"inDiv");<br>          return new Department(result);<br>       }<br>   }<br></span></big></pre></td><td style="white-space: nowrap; text-align: left; vertical-align: top;" colspan="1" rowspan="1"><pre><big style="font-weight: bold;">class childrenOf_parentsOf extends common&lt;childrenOf_parentsOf&gt; {<br>       protected childrenOf_parentsOf New(Table t) { return new childrenOf_parentsOf(t); }<br><br>       public childrenOf_parentsOf() { table = childrenof_parentsof; }<br><br>       public childrenOf_parentsOf(Table t) { super("childrenOf_parentsOf",t); }<br><br>       public childrenOf_parentsOf(Tuple t) {  super("childrenOf_parentsOf",t); }<br><br>       protected childrenOf_parentsOf(String n, Table t) { super(n,t); }<br><br>       protected childrenOf_parentsOf(String n, Tuple t) {  super(n,t); }<br>   }<br></big></pre></td></tr><tr><td style="font-family: monospace;"><pre><big><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span></big></pre></td><td><pre><big><span style="font-weight: bold;">class employs_worksin extends common&lt;employs_worksin&gt; {</span><br style="font-weight: bold;"><span style="font-weight: bold;"><br>       protected employs_worksin New(Table t) { return new employs_worksin(t); }<br><br>       public employs_worksin() { table = employs_worksin; }<br><br>       public employs_worksin(Table t) { super("employs_worksin",t); }<br><br>       public employs_worksin(Tuple t) {  super("employs_worksin",t); }<br><br>       protected employs_worksin(String n, Table t) { super(n,t); }<br><br>       protected employs_worksin(String n, Tuple t) {  super(n,t); }<br>   }<br></span></big></pre></td></tr></tbody></table><span style="font-family: Helvetica,Arial,sans-serif;"><br>A Catalina (MDELite-bootstrapped) specification of this design is:<br><br></span><div style="text-align: center;"><span style="font-family: Helvetica,Arial,sans-serif;"><img style="width: 855px; height: 235px;" alt="" src="figures/alleg.png"><br><br></span><div style="text-align: left;"><span style="font-family: Helvetica,Arial,sans-serif;">And a generated version of the above source is <a href="figures/alleg.txt">here</a>.</span><br><span style="font-family: Helvetica,Arial,sans-serif;"></span></div><span style="font-family: Helvetica,Arial,sans-serif;"></span></div><span style="font-family: Helvetica,Arial,sans-serif;"><br></span></body></html>   
